### A) Summary verdict

- Verdict: PASS_WITH_WARNINGS
- Confidence (0-100): 90
- One-paragraph rationale: The updated final C4 artifacts are strongly aligned with repository evidence for the main local runtime boundaries (CLI, API server, session engine, provider/MCP/plugin runtimes, policy/config/auth, SQLite, JSON storage) and cloud share worker boundaries (Worker, Durable Object, R2). The previous endpoint-contract over-claim is largely resolved by introducing the explicit external `Share Gateway API` boundary and splitting the edges (`Session -> Share Gateway -> Share API Worker`). Remaining risk is limited to one still-inferred relationship: the gateway translation itself is not directly implemented in this repository and is therefore partially evidenced, not fully verified.

### B) Claim audit table

| Claim ID | Claim                                                                                                                 | Status   | Evidence                                                                                                                                                                                                                                                              | Notes                                                                                                                          |
| -------- | --------------------------------------------------------------------------------------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| C01      | `CLI Runtime` is a concrete runtime container and command entrypoint                                                  | VERIFIED | `packages/opencode/src/index.ts:47`, `packages/opencode/src/index.ts:122`, `packages/opencode/src/index.ts:158`                                                                                                                                                       | yargs bootstrap, command registration, and parse path are explicit.                                                            |
| C02      | `CLI Runtime -> HTTP API Server` supports in-process or attached-server execution                                     | VERIFIED | `packages/opencode/src/cli/cmd/run.ts:604`, `packages/opencode/src/cli/cmd/run.ts:605`, `packages/opencode/src/cli/cmd/run.ts:612`                                                                                                                                    | Attach mode uses SDK/baseUrl; local mode calls `Server.App().fetch`.                                                           |
| C03      | `Web/App UI` consumes API + SSE via SDK client                                                                        | VERIFIED | `packages/app/src/context/global-sdk.tsx:41`, `packages/app/src/context/global-sdk.tsx:129`, `packages/app/src/context/global-sdk.tsx:203`                                                                                                                            | Dedicated event stream client and request client are present.                                                                  |
| C04      | `Desktop Shell` manages local sidecar lifecycle                                                                       | VERIFIED | `packages/desktop/src-tauri/src/cli.rs:416`, `packages/desktop/src-tauri/src/cli.rs:433`, `packages/desktop/src-tauri/src/server.rs:104`                                                                                                                              | Desktop spawns `opencode serve` and performs health checks.                                                                    |
| C05      | `HTTP API Server` is Bun + Hono ingress with route composition and SSE                                                | VERIFIED | `packages/opencode/src/server/server.ts:118`, `packages/opencode/src/server/server.ts:375`, `packages/opencode/src/server/server.ts:638`, `packages/opencode/src/server/server.ts:789`                                                                                | Hono app and Bun listener are concretely wired.                                                                                |
| C06      | `API -> Session Engine` dispatches prompt/command actions                                                             | VERIFIED | `packages/opencode/src/server/server.ts:381`, `packages/opencode/src/server/routes/session.ts:739`, `packages/opencode/src/server/routes/session.ts:808`                                                                                                              | Session routes call `SessionPrompt.prompt` and `SessionPrompt.command`.                                                        |
| C07      | `API -> Plugin Runtime` mounts plugin-provided routes                                                                 | VERIFIED | `packages/opencode/src/server/server.ts:84`, `packages/opencode/src/server/server.ts:355`, `packages/opencode/src/plugin/index.ts:148`                                                                                                                                | Plugin routes are collected and fetched before base routes.                                                                    |
| C08      | `API -> Config + Auth Policy` enforces auth/CORS/tool-endpoint policy                                                 | VERIFIED | `packages/opencode/src/server/server.ts:155`, `packages/opencode/src/server/server.ts:212`, `packages/opencode/src/server/server.ts:748`                                                                                                                              | Auth middleware, CORS handling, and tool-endpoint auth validation are explicit.                                                |
| C09      | `Session Engine -> Provider Runtime/MCP Gateway/Plugin Runtime` orchestration is implemented                          | VERIFIED | `packages/opencode/src/session/prompt.ts:732`, `packages/opencode/src/session/prompt.ts:830`, `packages/opencode/src/session/prompt.ts:794`                                                                                                                           | Session resolves provider model, MCP tools, and plugin hook triggers.                                                          |
| C10      | `Provider Runtime` reads config/auth/env and performs outbound model calls                                            | VERIFIED | `packages/opencode/src/provider/provider.ts:133`, `packages/opencode/src/provider/provider.ts:212`, `packages/opencode/src/provider/provider.ts:407`                                                                                                                  | Provider config/auth resolution and outbound fetch paths exist.                                                                |
| C11      | `MCP Gateway` supports stdio + remote HTTP/SSE connectivity                                                           | VERIFIED | `packages/opencode/src/mcp/index.ts:328`, `packages/opencode/src/mcp/index.ts:338`, `packages/opencode/src/mcp/index.ts:411`, `packages/opencode/src/mcp/index.ts:566`                                                                                                | Multiple MCP transports and tool inventory are implemented.                                                                    |
| C12      | `Plugin Runtime` loads internal and external plugins from package/file sources                                        | VERIFIED | `packages/opencode/src/plugin/index.ts:24`, `packages/opencode/src/plugin/index.ts:69`, `packages/opencode/src/plugin/index.ts:74`, `packages/opencode/src/plugin/index.ts:93`                                                                                        | Internal list + external install/import flow are concrete.                                                                     |
| C13      | `Config + Auth Policy -> Project Filesystem + Git` config/auth input loading exists                                   | VERIFIED | `packages/opencode/src/config/config.ts:71`, `packages/opencode/src/config/config.ts:112`, `packages/opencode/src/config/config.ts:130`, `packages/opencode/src/auth/index.ts:37`, `packages/opencode/src/auth/index.ts:45`                                           | Global/project `.opencode` loading and auth file reads are explicit.                                                           |
| C14      | `Session Engine -> SQLite DB` and `Session Engine -> JSON State Store` persistence boundaries exist                   | VERIFIED | `packages/opencode/src/storage/db.ts:28`, `packages/opencode/src/storage/db.ts:71`, `packages/opencode/src/storage/storage.ts:169`, `packages/opencode/src/storage/storage.ts:191`                                                                                    | SQLite database and JSON file read/write paths are both implemented.                                                           |
| C15      | Cloud share runtime (`Share API Worker`, `Share Sync Durable Object`, `Share Bucket`) is real                         | VERIFIED | `packages/function/src/api.ts:29`, `packages/function/src/api.ts:131`, `packages/function/src/api.ts:163`, `packages/function/src/api.ts:68`                                                                                                                          | Worker routes, DO, and R2 persistence are directly anchored.                                                                   |
| C16      | `HTTP API Server -> app.opencode.ai` fallback proxy is modeled and implemented                                        | VERIFIED | `packages/opencode/src/server/server.ts:698`, `docs/architecture/c4-opencode-final.puml:53`                                                                                                                                                                           | Catch-all proxy behavior is represented in diagram and code.                                                                   |
| C17      | `Session Engine -> Share Gateway API` and `Share Gateway API -> Share API Worker` contract is fully evidenced in-repo | PARTIAL  | `packages/opencode/src/share/share-next.ts:72`, `packages/opencode/src/share/share-next.ts:148`, `packages/function/src/api.ts:131`, `packages/function/src/api.ts:163`, `docs/architecture/c4-opencode-final.puml:61`, `docs/architecture/c4-opencode-final.puml:74` | Local `/api/share*` and worker `/share_*` are evidenced; translation boundary is reasonable but implemented outside this repo. |
| C18      | `Automation Client (inferred) -> HTTP API Server` is an external actor edge                                           | VERIFIED | `docs/architecture/c4-opencode-final.puml:8`, `docs/architecture/c4-analysis-notes-final.md:35`, `packages/opencode/src/server/server.ts:375`, `packages/opencode/src/server/server.ts:638`                                                                           | Explicitly marked inferred/external; API/SSE ingress supports this actor class.                                                |

### C) Hallucination report

- medium - `Share Gateway API` translation behavior is not directly anchored by implementation in this repository
  - why unsupported: code shows local caller endpoints (`/api/share*`) and worker endpoints (`/share_*`), but not the intermediary translation layer implementation.
  - exact fix: keep gateway as external, but relabel description/edge text to "external share edge routing (out-of-repo)" or cite a concrete gateway repo/path if available.

### D) Omission report

- low - No critical container boundary omission detected in current scope
  - evidence for why: ingress/API, orchestration, integration (provider/MCP/plugin), extension hooks/routes, persistence, policy/auth/config, and cloud share boundaries are all represented.
  - exact fix: none required for PASS_WITH_WARNINGS.

### E) Minimal correction plan

1. In `docs/architecture/c4-opencode-final.puml`, soften `Share Gateway API` description to avoid implied in-repo ownership (for example, "External edge routing for share requests").
2. In `docs/architecture/c4-analysis-notes-final.md`, add one explicit sentence that gateway translation is out-of-repo and therefore intentionally `PARTIAL` evidence.
3. Optionally add one external evidence link/reference (deployment doc or gateway source) to upgrade C17 from `PARTIAL` to `VERIFIED`.

### F) Offer to apply corrections

- If you want, I can apply the minimal text-only corrections in:
  - `docs/architecture/c4-opencode-final.puml`
  - `docs/architecture/c4-analysis-notes-final.md`
- Since `APPLY_CORRECTIONS=false`, no edits were applied.
